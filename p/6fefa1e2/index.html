<!DOCTYPE html><html><head hexo-theme="https://volantis.js.org/#2.6.3"><meta charset="utf-8"><meta name="renderer" content="webkit"><meta name="force-rendering" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="HandheldFriendly" content="True"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>KVC的本质 - ticsmatic</title><meta name="description" content="学习MJ的视频课程，整理并记录知识点–KVC的本质"><link rel="alternate" href="/atom.xml" title="ticsmatic"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css"><link rel="shortcut icon" type="image/x-icon" href="https://cdn.ticsmatic.com/img/favicon.png"><link rel="stylesheet" href="/css/style.css"><script>function setLoadingBarProgress(e){document.getElementById("loading-bar").style.width=e+"%"}</script></head><body><div id="loading-bar-wrapper"><div id="loading-bar"></div></div><header class="l_header shadow blur"><div class="container"><div class="wrapper"><div class="nav-sub"><p class="title"></p><ul class="switcher nav-list-h"><li><a class="s-comment fas fa-comments fa-fw" target="_self" href="javascript:void(0)"></a></li><li><a class="s-toc fas fa-list fa-fw" target="_self" href="javascript:void(0)"></a></li></ul></div><div class="nav-main"><a class="title flat-box" target="_self" href="/">ticsmatic</a><div class="menu navigation"><ul class="nav-list-h"><li><a class="flat-box" href="/" id="home"><i class="fas fa-rss fa-fw"></i>博文</a></li><li><a class="flat-box" href="/archives/" id="archives"><i class="fas fa-archive fa-fw"></i>归档</a></li><li><a class="flat-box" href="/categories/" id="categories"><i class="fas fa-folder-open fa-fw"></i>分类</a></li><li><a class="flat-box" href="/tags/" id="tags"><i class="fas fa-tags fa-fw"></i>标签</a></li><li><a class="flat-box" href="/about/" id="about"><i class="fas fa-info-circle fa-fw"></i>关于</a></li></ul></div><div class="m_search"><form name="searchform" class="form u-search-form"><i class="icon fas fa-search fa-fw"></i> <input type="text" class="input u-search-input" placeholder="Search..."></form></div><ul class="switcher nav-list-h"><li><a class="s-search fas fa-search fa-fw" target="_self" href="javascript:void(0)"></a></li><li><a class="s-menu fas fa-bars fa-fw" target="_self" href="javascript:void(0)"></a><ul class="menu-phone list-v navigation white-box"><li><a class="flat-box" href="/" id="home"><i class="fas fa-rss fa-fw"></i>博文</a></li><li><a class="flat-box" href="/archives/" id="archives"><i class="fas fa-archive fa-fw"></i>归档</a></li><li><a class="flat-box" href="/categories/" id="categories"><i class="fas fa-folder-open fa-fw"></i>分类</a></li><li><a class="flat-box" href="/tags/" id="tags"><i class="fas fa-tags fa-fw"></i>标签</a></li><li><a class="flat-box" href="/about/" id="about"><i class="fas fa-info-circle fa-fw"></i>关于</a></li></ul></li></ul></div></div></div></header><script>setLoadingBarProgress(40)</script><div class="l_body nocover"><div class="body-wrapper"><div class="l_main"><article id="post" class="post white-box shadow article-type-post" itemscope itemprop="blogPost"><section class="meta"><div class="meta" id="header-meta"><h1 class="title"><a href="/p/6fefa1e2/">KVC的本质</a></h1><div class="new-meta-box"><div class="new-meta-item date"><a class="notlink"><i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i><p>2020-04-30</p></a></div><div class="new-meta-item browse busuanzi"><a class="notlink"><i class="fas fa-eye fa-fw" aria-hidden="true"></i><p><span id="busuanzi_value_page_pv"><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span></p></a></div></div><hr></div></section><section class="article typo"><div class="article-entry" itemprop="articleBody"><p>学习MJ的视频课程，整理并记录知识点–KVC的本质</p><a id="more"></a><p>[TOC]</p><p>KVC的全称是<code>Key-Value Coding</code>，俗称“键值编码”，可以通过一个key来访问某个属性</p><p>常见的API有</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)setValue:(<span class="keyword">id</span>)value forKeyPath:(<span class="built_in">NSString</span> *)keyPath;</span><br><span class="line">- (<span class="keyword">void</span>)setValue:(<span class="keyword">id</span>)value forKey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line">- (<span class="keyword">id</span>)valueForKeyPath:(<span class="built_in">NSString</span> *)keyPath;</span><br><span class="line">- (<span class="keyword">id</span>)valueForKey:(<span class="built_in">NSString</span> *)key;</span><br></pre></td></tr></table></figure><h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><h3 id="设值"><a href="#设值" class="headerlink" title="设值"></a>设值</h3><p>1、我们可以通过<code>-setValue:forKey:</code>，或者<code>-setValue:forKeyPath:</code>给对象的属性赋值，也可以直接调用对象的属性赋值，如下三个方法的效果等价。</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">person.age = <span class="number">10</span>;</span><br><span class="line">[person setValue:@<span class="number">10</span> forKey:<span class="string">@"age"</span>];</span><br><span class="line">[person setValue:@<span class="number">10</span> forKeyPath:<span class="string">@"age"</span>];</span><br></pre></td></tr></table></figure><p><code>-setValue:forKey:</code>、<code>-setValue:forKeyPath:</code>这两个方法的调用结果一样，函数名很相似，它们两个的区别是什么？</p><p>我们先看它的<a href="https://developer.apple.com/documentation/objectivec/nsobject/1418139-setvalue?language=objc" target="_blank" rel="noopener">API文档</a></p><blockquote><p>Discussion</p><p>The default implementation of this method gets the destination object for each relationship using valueForKey:, and sends the final object a setValue:forKey: message.</p></blockquote><p>可以概述如下：<code>-setValue:forKeyPath:</code>支持路径方式的参数（<code>[person setValue:@10 forKeyPath:@&quot;cat.weight&quot;];</code>），<br>它会新利用路径查找到指定的层级，内部最终是会调用<code>-setValue:forKey:</code></p><p>2、KVC的另一种使用场景就是我么利用它进行对象的私有属性赋值。</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[searchField setValue:[<span class="built_in">UIColor</span> whiteColor] forKeyPath:<span class="string">@"_placeholderLabel.textColor"</span>];</span><br></pre></td></tr></table></figure><p>但是在iOS13以后，系统对象通过KVC设置私有属性已被禁止。</p><h3 id="取值"><a href="#取值" class="headerlink" title="取值"></a>取值</h3><p>相对应的取值方式为<code>-valueForKey:</code>、<code>-valueForKeyPath:</code>，使用很简单</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">person.age;</span><br><span class="line">[person valueForKey:<span class="string">@"age"</span>];</span><br><span class="line">[person valueForKeyPath:<span class="string">@"age"</span>];</span><br></pre></td></tr></table></figure><h2 id="setValue-forKey-的原理"><a href="#setValue-forKey-的原理" class="headerlink" title="-setValue:forKey:的原理"></a>-setValue:forKey:的原理</h2><p><code>-setValue:forKey:</code>是<code>Foundation</code>的函数，我们看不到源码，不过这个API的接口文档很详细。<a href="https://developer.apple.com/documentation/objectivec/nsobject/1415969-setvalue?language=objc" target="_blank" rel="noopener">-setValue:forKey:</a></p><p>同时，在<code>Foundation</code>的头文件中，函数的描述如下：</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Given a value and a key that identifies an attribute, set the value of the attribute. Given an object and a key that identifies a to-one relationship, relate the object to the receiver, unrelating the previously related object if there was one. Given a collection object and a key that identifies a to-many relationship, relate the objects contained in the collection to the receiver, unrelating previously related objects if there were any.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">The default implementation of this method does the following:</span></span><br><span class="line"><span class="comment">    1. Searches the class of the receiver for an accessor method whose name matches the pattern -set&lt;Key&gt;:. If such a method is found the type of its parameter is checked. If the parameter type is not an object pointer type but the value is nil -setNilValueForKey: is invoked. The default implementation of -setNilValueForKey: raises an NSInvalidArgumentException, but you can override it in your application. Otherwise, if the type of the method's parameter is an object pointer type the method is simply invoked with the value as the argument. If the type of the method's parameter is some other type the inverse of the NSNumber/NSValue conversion done by -valueForKey: is performed before the method is invoked.</span></span><br><span class="line"><span class="comment">    2. Otherwise (no accessor method is found), if the receiver's class' +accessInstanceVariablesDirectly property returns YES, searches the class of the receiver for an instance variable whose name matches the pattern _&lt;key&gt;, _is&lt;Key&gt;, &lt;key&gt;, or is&lt;Key&gt;, in that order. If such an instance variable is found and its type is an object pointer type the value is retained and the result is set in the instance variable, after the instance variable's old value is first released. If the instance variable's type is some other type its value is set after the same sort of conversion from NSNumber or NSValue as in step 1.</span></span><br><span class="line"><span class="comment">    3. Otherwise (no accessor method or instance variable is found), invokes -setValue:forUndefinedKey:. The default implementation of -setValue:forUndefinedKey: raises an NSUndefinedKeyException, but you can override it in your application.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Compatibility notes:</span></span><br><span class="line"><span class="comment">    - For backward binary compatibility with -takeValue:forKey:'s behavior, a method whose name matches the pattern -_set&lt;Key&gt;: is also recognized in step 1. KVC accessor methods whose names start with underscores were deprecated as of Mac OS 10.3 though.</span></span><br><span class="line"><span class="comment">    - For backward binary compatibility, -unableToSetNilForKey: will be invoked instead of -setNilValueForKey: in step 1, if the implementation of -unableToSetNilForKey: in the receiver's class is not NSObject's.</span></span><br><span class="line"><span class="comment">    - The behavior described in step 2 is different from -takeValue:forKey:'s, in which the instance variable search order is &lt;key&gt;, _&lt;key&gt;.</span></span><br><span class="line"><span class="comment">    - For backward binary compatibility with -takeValue:forKey:'s behavior, -handleTakeValue:forUnboundKey: will be invoked instead of -setValue:forUndefinedKey: in step 3, if the implementation of -handleTakeValue:forUnboundKey: in the receiver's class is not NSObject's.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)setValue:(<span class="keyword">nullable</span> <span class="keyword">id</span>)value forKey:(<span class="built_in">NSString</span> *)key;</span><br></pre></td></tr></table></figure><p>我们可以结合文档，整理出<code>-setValue:forKey:</code>内部的主要逻辑如下：<br><img src="https://cdn.ticsmatic.com/img/2020-05-03/15884770977532.png" alt="-setValue:forKey:"></p><p>KVC底层调用<br><code>willChangeValueForKey:</code>、<code>didChangeValueForKey:</code></p><h2 id="valueForKey-的原理"><a href="#valueForKey-的原理" class="headerlink" title="-valueForKey:的原理"></a>-valueForKey:的原理</h2><p><code>-valueForKey:</code>函数核心原理和<code>-setValue:forKey:</code>很类似，一个是设置值，一个是取值。它的原理如下：<br><img src="https://cdn.ticsmatic.com/img/2020-05-22/15901113874382.png" alt="-valueForKey:"></p><h2 id="KVC触发KVO的observer"><a href="#KVC触发KVO的observer" class="headerlink" title="KVC触发KVO的observer"></a>KVC触发KVO的observer</h2><p>KVC是键值编码、KVO的键值监听，从定义的描述可推测两者之前似乎有关联。他们关联也就是<strong>键值</strong>，一个是设置修改键值、一个是监听键值的修改。那么通过KVC修改属性会触发KVO么？答案是：会</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加KVO监听</span></span><br><span class="line">[person addObserver:observer forKeyPath:<span class="string">@"age"</span> options:<span class="built_in">NSKeyValueObservingOptionNew</span> | <span class="built_in">NSKeyValueObservingOptionOld</span> context:<span class="literal">NULL</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过KVC修改age属性</span></span><br><span class="line">[person setValue:@<span class="number">10</span> forKeyPath:<span class="string">@"age"</span>];</span><br></pre></td></tr></table></figure><p>我们在<code>KVO</code>的那一章中介绍过，触发KVO的关键代码是<code>-willChangeValueForKey:</code>，<code>-didChangeValueForKey:</code>，</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">self</span>.person1 willChangeValueForKey:<span class="string">@"age"</span>];</span><br><span class="line"><span class="keyword">self</span>.person1-&gt;_age = <span class="number">10</span>;</span><br><span class="line">[<span class="keyword">self</span>.person1 didChangeValueForKey:<span class="string">@"age"</span>];</span><br></pre></td></tr></table></figure><p>我们可以在<code>person</code>的class中实现<code>-willChangeValueForKey:</code>，<code>-didChangeValueForKey:</code>，进行调试，结论是，通过KVC设置属性会调用这两个方法，也就会触发KVO</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>知道KVC的调用顺序<br>通过KVC设置属性会触发KVO</p><h2 id="源码和参考"><a href="#源码和参考" class="headerlink" title="源码和参考"></a>源码和参考</h2><p>apple document：<a href="https://developer.apple.com/documentation/objectivec/nsobject/1415969-setvalue?language=objc" target="_blank" rel="noopener">setvalue</a></p><div class="article_footer"><section class="widget copyright desktop mobile"><div class="content"><blockquote><p>博客内容遵循 署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</p><p>本文永久链接是：<a href="https://ticsmatic.com/p/6fefa1e2/">https://ticsmatic.com/p/6fefa1e2/</a></p></blockquote></div></section><section class="widget qrcode desktop mobile"><div class="content article-entry"></div></section></div></div><section class="meta" id="footer-meta"><div class="new-meta-box"><div class="new-meta-item date" itemprop="dateUpdated" datetime="2020-05-22T09:36:45+08:00"><a class="notlink"><i class="fas fa-edit fa-fw" aria-hidden="true"></i><p>更新于：2020-05-22</p></a></div><div class="new-meta-item share -mob-share-list"><div class="-mob-share-list share-body"><a class="-mob-share-qq" rel="external nofollow noopener noreferrer noopener" href="http://connect.qq.com/widget/shareqq/index.html?url=https://ticsmatic.com/p/6fefa1e2/&title=KVC的本质 - ticsmatic&summary=学习MJ的视频课程，整理并记录知识点–KVC的本质" target="_blank"><img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/qq.png"> </a><a class="-mob-share-qzone" rel="external nofollow noopener noreferrer noopener" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://ticsmatic.com/p/6fefa1e2/&title=KVC的本质 - ticsmatic&summary=学习MJ的视频课程，整理并记录知识点–KVC的本质" target="_blank"><img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/qzone.png"> </a><a class="-mob-share-weibo" rel="external nofollow noopener noreferrer noopener" href="http://service.weibo.com/share/share.php?url=https://ticsmatic.com/p/6fefa1e2/&title=KVC的本质 - ticsmatic&summary=学习MJ的视频课程，整理并记录知识点–KVC的本质" target="_blank"><img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/weibo.png"></a><div class="hoverbox"><a><img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/wechat.png"></a><div class="target"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARgAAAEYCAAAAACi5bZQAAAC8ElEQVR42u3aS3ICMQwFwLn/pZMDJBT6GUbQ3pGJzbjZvJJ0/Vj/rgsBGDBgwIABswbmKq4/Byb/7+GLPdj/7PPUfcCAAQMGDBgw+2DCASh4seg5UYDsudX7gAEDBgwYMGD2wjwNQMWg1b1odF/7PmDAgAEDBgyYr4XJwk0HPzBgwIABAwYMmKkvzjbEPi7ggQEDBgwYMGBeBpNuUBUHhLLnVgPe2zqRYMCAAQMGDJiXwWTXVOHq1OfyfcCAAQMGDBgwa2C663RDLlvYat8HDBgwYMCAAbMGphqQooWp6v7qeV1QMGDAgAEDBswemLuAZBtq0+eBAQMGDBgwYPbDdAdzsoErO4BUBQnDggEDBgwYMGDWwGQ3nipwdfdNvRcYMGDAgAEDZh9Mt5GVHRTqgmULU+F9YMCAAQMGDJi1MNFAFx2M7hamqoWs6H3AgAEDBgwYMPthpgaCuo2vblCrBj4wYMCAAQMGzH6Y6gXCgznB59mAeSXXw3PAgAEDBgwYMGtgpoCmG3HpAlPzPDBgwIABAwbMPpjqgafBpvalQcGAAQMGDBgwa2Cyg0JRsCzcqR8qWmADAwYMGDBgwOyD6Q4IHRvgKZ7fDopgwIABAwYMmHUw3UJPN8h1/159/jTggQEDBgwYMGBuD1O9SDdYdYNeFmh8cAgMGDBgwIABswYm+7wa7NKNsmIjcCzggQEDBgwYMGDeDpN9kVMXyjbYxoInGDBgwIABA2Y9TLVxVb3Q1EBQ9XvBgAEDBgwYMPtguqsbxKoNtGqADAc8MGDAgAEDBsztYU4HpmqBqxoE24UzMGDAgAEDBsw6mGygm96f/SFOFc7AgAEDBgwYMHthugEqW4DqDg5VgykYMGDAgAEDBkz1RZ6BdBtn5fuAAQMGDBgwYL4OJltIyl6sOsiUbgiCAQMGDBgwYNbCZBtm2YBWffGpfWDAgAEDBgyYz4OZalxNFYyOB7loww0MGDBgwIABc1sYCwwYMGDAgAGzbP0CA8jn4Y/9WsgAAAAASUVORK5CYII="></div></div></div></div></div></section><div class="prev-next"><a class="prev" href="/p/e15d38f8/"><p class="title"><i class="fas fa-chevron-left" aria-hidden="true"></i>Category的本质</p><p class="content">学习MJ的视频课程，整理总结知识点–Category的本质[TOC]Category基本使用category 是对装饰模式的一种具体实现。它的主要作用是在不改变原有类的前提下，动态地给这个类添加...</p></a><a class="next" href="/p/4dec9c48/"><p class="title">KVO的实现原理<i class="fas fa-chevron-right" aria-hidden="true"></i></p><p class="content">学习MJ的视频课程，整理并记录知识点–KVO的实现原理[TOC]KVO的全称是Key-Value Observing，俗称“键值监听”，可以用于监听某个对象属性值的改变。KVO的使用先回忆下，关...</p></a></div></section></article><article class="post white-box comments shadow"><section class="article typo"><p ct><i class="fas fa-comments"></i> 评论</p><section id="comments"><div id="valine_container" class="valine_thread"><i class="fas fa-cog fa-spin fa-fw fa-2x"></i></div></section></section></article><script>window.subData={title:"KVC的本质",tools:!0}</script></div><aside class="l_side"><section class="widget toc-wrapper shadow desktop mobile"><header><i class="fas fa-list fa-fw" aria-hidden="true"></i><span class="name">本文目录</span></header><div class="content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#基本使用"><span class="toc-text">基本使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#设值"><span class="toc-text">设值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#取值"><span class="toc-text">取值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#setValue-forKey-的原理"><span class="toc-text">-setValue:forKey:的原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#valueForKey-的原理"><span class="toc-text">-valueForKey:的原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KVC触发KVO的observer"><span class="toc-text">KVC触发KVO的observer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#源码和参考"><span class="toc-text">源码和参考</span></a></li></ol></div></section></aside><footer class="clearfix"><br><br><br><div class="social-wrapper"><a href="/atom.xml" class="social fas fa-rss flat-btn" target="_blank" rel="external nofollow noopener noreferrer"></a> <a href="mailto:ticsmatics@gmail.com" class="social fas fa-envelope flat-btn" target="_blank" rel="external nofollow noopener noreferrer"></a> <a href="https://github.com/ticsmatic" class="social fab fa-github flat-btn" target="_blank" rel="external nofollow noopener noreferrer"></a></div><div class="copyright"><p><a href="https://ticsmatic.com">Copyright © 2016-2020 ticsmatic</a></p></div></footer><script>setLoadingBarProgress(80)</script><script>setLoadingBarProgress(60)</script></div><a class="s-top fas fa-arrow-up fa-fw" href="javascript:void(0)"></a></div><script src="https://cdn.jsdelivr.net/npm/jquery@3.4/dist/jquery.min.js"></script><script>var SEARCH_SERVICE="hexo",ROOT="/";ROOT.endsWith("/")||(ROOT+="/")</script><script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2/js/instant_page.js" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script><script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script><script type="text/javascript">$(function(){Waves.attach(".flat-btn",["waves-button"]),Waves.attach(".float-btn",["waves-button","waves-float"]),Waves.attach(".float-btn-light",["waves-button","waves-float","waves-light"]),Waves.attach(".flat-box",["waves-block"]),Waves.attach(".float-box",["waves-block","waves-float"]),Waves.attach(".waves-image"),Waves.init()})</script><script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery-backstretch@2.1.18/jquery.backstretch.min.js"></script><script type="text/javascript">$(function(){var a=["https://cdn.ticsmatic.com/img/wallpaper/autumn-background-beautiful-bright-627823.jpg"];!function(a){for(var t=a.length;t--;){var r=Math.floor(Math.random()*t),c=a[r];a[r]=a[t],a[t]=c}}(a),$(".cover").backstretch(a,{duration:"20000",fade:"1500"})})</script><script src="https://cdn.ticsmatic.com/script/Valine.min.js"></script><script>var GUEST_INFO=["nick","mail","link"],meta="nick,mail,link".split(",").filter(function(i){return-1<GUEST_INFO.indexOf(i)}),valine=new Valine;valine.init({el:"#valine_container",meta:meta,appId:"VNmRxpFEai4571pMche8o8ir-gzGzoHsz",appKey:"x06wrMifXe5j784k7CEk9zNA",placeholder:"快来评论吧~",pageSize:"10",avatar:"mp",lang:"zh-cn",visitor:"false",highlight:"true",mathJax:"false"})</script><script src="/js/app.js"></script><script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2.4/js/search.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script><script>function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="fas fa-copy"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('fa-copy');
        $icon.addClass('fa-check-circle');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('fa-check-circle');
          $icon.addClass('fa-copy');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('fa-copy');
        $icon.addClass('fa-times-circle');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('fa-times-circle');
          $icon.addClass('fa-copy');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);</script><script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script>let LAZY_LOAD_IMAGE = "";
  $(".article-entry").find("div.fancybox").find("img").each(function () {
      var element = document.createElement("a");
      $(element).attr("data-fancybox", "gallery");
      $(element).attr("href", $(this).attr("src"));
      /* 图片采用懒加载处理时,
       * 一般图片标签内会有个属性名来存放图片的真实地址，比如 data-original,
       * 那么此处将原本的属性名src替换为对应属性名data-original,
       * 修改如下
       */
       if (LAZY_LOAD_IMAGE) {
         $(element).attr("href", $(this).attr("data-original"));
       }
      $(this).wrap(element);
  });</script><script>setLoadingBarProgress(100)</script></body></html>